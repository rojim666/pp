import{_ as z,s as U,r as S,E as d,q as Z,o as r,c as i,b as t,e as h,v as F,D as M,d as $,h as _,t as o,F as u,z as v,I as b,A as D}from"./index-324e4295.js";import{u as Y}from"./record-aeecdbba.js";import"./index-1d215042.js";const O={class:"page"},P={class:"card date-filter"},Q={class:"filter-group"},G={class:"filter-item"},J={class:"filter-item"},K={class:"filter-item"},X={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"18px",height:"18px","margin-right":"6px"}},tt={class:"stats-row"},st={class:"stat-card"},et={class:"stat-info"},at={class:"stat-value"},ot={class:"stat-card"},nt={class:"stat-info"},lt={class:"stat-value"},rt={class:"stat-card"},it={class:"stat-info"},dt={class:"stat-value"},ct={class:"stat-card"},ut={class:"stat-info"},vt={class:"stat-value"},pt={class:"charts-row"},gt={class:"card chart-card"},ht={class:"chart-container"},_t={class:"chart-bars"},ft={class:"bar-tooltip"},kt={class:"bar-label"},mt={class:"card chart-card"},yt={class:"chart-container"},wt={class:"pie-chart"},St={viewBox:"0 0 200 200",class:"pie-svg"},bt=["stroke","stroke-dasharray","stroke-dashoffset"],xt={class:"pie-center"},Ct={class:"pie-total"},Ft={class:"pie-legend"},Mt={class:"legend-name"},$t={class:"legend-value"},Dt={class:"legend-percent"},Vt={class:"card"},Ht={class:"section-header"},Bt={class:"toolbar-right"},Lt={class:"ranking-list"},Rt={class:"station-info"},jt={class:"station-name"},It={class:"station-location"},Et={class:"station-stats"},Nt={class:"stat-item"},Tt={class:"stat-value revenue"},Wt={class:"stat-item"},qt={class:"stat-value energy"},At={class:"stat-item"},zt={class:"stat-value sessions"},Ut={class:"progress-bar"},Zt={class:"card"},Yt={class:"section-header"},Ot={class:"toolbar-right"},Pt={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"16px",height:"16px","margin-right":"6px"}},Qt={class:"table-container"},Gt={class:"data-table"},Jt={class:"date-col"},Kt={class:"station-col"},Xt={class:"user-col"},ts={class:"duration-col"},ss={class:"energy-col"},es={class:"price-col"},as={class:"cost-col"},os={class:"payment-col"},ns={__name:"Statistics",setup(ls){const x=Y(),{records:p,loading:rs}=U(x),n=S({start:"",end:""}),f=S("month"),V=()=>{const e=new Date,s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");n.value.start=`${s}-${a}-01`,n.value.end=`${s}-${a}-${l}`},H=()=>{const e=new Date,s=e.getFullYear(),a=e.getMonth(),l=e.getDate();switch(f.value){case"today":n.value.start=n.value.end=`${s}-${String(a+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`;break;case"week":const w=new Date(e.setDate(l-e.getDay()+1));n.value.start=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}-${String(w.getDate()).padStart(2,"0")}`,n.value.end=`${s}-${String(a+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`;break;case"month":n.value.start=`${s}-${String(a+1).padStart(2,"0")}-01`,n.value.end=`${s}-${String(a+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`;break;case"quarter":const A=Math.floor(a/3)*3;n.value.start=`${s}-${String(A+1).padStart(2,"0")}-01`,n.value.end=`${s}-${String(a+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`;break;case"year":n.value.start=`${s}-01-01`,n.value.end=`${s}-${String(a+1).padStart(2,"0")}-${String(l).padStart(2,"0")}`;break}k()},k=async()=>{await x.fetchRecords({startTime:n.value.start,endTime:n.value.end,status:"completed"})},c=d(()=>{const e=p.value.filter(s=>s.status==="completed");return{revenue:e.reduce((s,a)=>s+a.totalFee,0),energy:e.reduce((s,a)=>s+a.energy,0),sessions:e.length,users:new Set(e.map(s=>s.userId)).size}}),m=d(()=>{const e={};return p.value.forEach(s=>{if(s.status!=="completed")return;const a=s.startTime.substring(5,10);e[a]||(e[a]=0),e[a]+=s.totalFee}),Object.keys(e).sort().map(s=>({date:s,amount:e[s]}))}),B=d(()=>m.value.length===0?100:Math.max(...m.value.map(e=>e.amount))),L=(e,s)=>s===0?0:e/s*100,C=d(()=>{const e=c.value.energy;return e===0?[]:[{name:"全部充电",value:e,percentage:100,color:"#007AFF"}]}),R=d(()=>{let e=0;return C.value.map(s=>{const a={percentage:s.percentage,color:s.color,offset:-e};return e+=s.percentage*502.4/100,a})}),g=S("revenue"),y=d(()=>{const e={};return p.value.forEach(s=>{s.status==="completed"&&(e[s.stationId]||(e[s.stationId]={id:s.stationId,name:s.stationName,location:"未知位置",revenue:0,energy:0,sessions:0}),e[s.stationId].revenue+=s.totalFee,e[s.stationId].energy+=s.energy,e[s.stationId].sessions+=1)}),Object.values(e)}),j=d(()=>[...y.value].sort((e,s)=>s[g.value]-e[g.value])),I=d(()=>y.value.length===0?100:Math.max(...y.value.map(e=>e.revenue))),E=(e,s)=>s===0?0:e/s*100,N=e=>e===0?"rank-1":e===1?"rank-2":e===2?"rank-3":"",T=d(()=>p.value.map(e=>({id:e.id,date:e.startTime,station:e.stationName,user:e.userName,duration:e.duration+"分钟",energy:e.energy,price:e.totalFee/(e.energy||1),cost:e.totalFee,payment:e.paymentMethod||"wechat"}))),W=e=>({wechat:"微信支付",alipay:"支付宝",card:"银行卡"})[e]||e,q=()=>{console.log("导出数据"),alert("导出功能开发中...")};return Z(()=>{V(),k()}),(e,s)=>(r(),i("div",O,[s[31]||(s[31]=t("h1",{class:"page-title"},"充电费用统计",-1)),t("div",P,[t("div",Q,[t("div",G,[s[4]||(s[4]=t("label",null,"开始日期",-1)),h(t("input",{type:"date","onUpdate:modelValue":s[0]||(s[0]=a=>n.value.start=a),class:"date-input"},null,512),[[F,n.value.start]])]),t("div",J,[s[5]||(s[5]=t("label",null,"结束日期",-1)),h(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=a=>n.value.end=a),class:"date-input"},null,512),[[F,n.value.end]])]),t("div",K,[s[7]||(s[7]=t("label",null,"快捷选择",-1)),h(t("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>f.value=a),onChange:H,class:"quick-select"},[...s[6]||(s[6]=[$('<option value="" data-v-83ffd074>自定义</option><option value="today" data-v-83ffd074>今天</option><option value="week" data-v-83ffd074>本周</option><option value="month" data-v-83ffd074>本月</option><option value="quarter" data-v-83ffd074>本季度</option><option value="year" data-v-83ffd074>本年</option>',6)])],544),[[M,f.value]])]),t("button",{class:"btn-primary",onClick:k},[(r(),i("svg",X,[...s[8]||(s[8]=[t("path",{d:"M21 10C21 10 18.995 7.26822 17.3662 5.63824C15.7373 4.00827 13.4864 3 11 3C6.02944 3 2 7.02944 2 12C2 16.9706 6.02944 21 11 21C15.1031 21 18.5649 18.2543 19.6482 14.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M21 10V4M21 10H15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),s[9]||(s[9]=_(" 刷新数据 ",-1))])])]),t("div",tt,[t("div",st,[s[11]||(s[11]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #007AFF, #0051D5)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z",fill:"currentColor"}),t("path",{d:"M12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z",fill:"currentColor"})])],-1)),t("div",et,[t("div",at,o(c.value.revenue.toFixed(2)),1),s[10]||(s[10]=t("div",{class:"stat-label"},"总收入 (元)",-1))])]),t("div",ot,[s[13]||(s[13]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #34C759, #30D158)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M13 2L3 14H12L11 22L21 10H12L13 2Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"})])],-1)),t("div",nt,[t("div",lt,o(c.value.energy.toFixed(1)),1),s[12]||(s[12]=t("div",{class:"stat-label"},"总用电量 (kWh)",-1))])]),t("div",rt,[s[15]||(s[15]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #FF9500, #FF6B00)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor","stroke-width":"2",fill:"none"}),t("path",{d:"M3 10H21M8 14H8.01M12 14H12.01M16 14H16.01M8 18H8.01M12 18H12.01M16 18H16.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",it,[t("div",dt,o(c.value.sessions),1),s[14]||(s[14]=t("div",{class:"stat-label"},"充电次数",-1))])]),t("div",ct,[s[17]||(s[17]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #5856D6, #AF52DE)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"}),t("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor","stroke-width":"2",fill:"none"})])],-1)),t("div",ut,[t("div",vt,o(c.value.users),1),s[16]||(s[16]=t("div",{class:"stat-label"},"活跃用户",-1))])])]),t("div",pt,[t("div",gt,[s[18]||(s[18]=$('<div class="chart-header" data-v-83ffd074><h3 class="chart-title" data-v-83ffd074>收入趋势</h3><div class="chart-legend" data-v-83ffd074><span class="legend-item" data-v-83ffd074><span class="legend-dot" style="background:#007AFF;" data-v-83ffd074></span> 每日收入 </span></div></div>',1)),t("div",ht,[t("div",_t,[(r(!0),i(u,null,v(m.value,(a,l)=>(r(),i("div",{key:l,class:"bar-item"},[t("div",{class:"bar",style:b({height:L(a.amount,B.value)+"%"})},[t("div",ft,"¥"+o(a.amount.toFixed(2)),1)],4),t("div",kt,o(a.date),1)]))),128))])])]),t("div",mt,[s[21]||(s[21]=t("div",{class:"chart-header"},[t("h3",{class:"chart-title"},"用电量分布")],-1)),t("div",yt,[t("div",wt,[(r(),i("svg",St,[s[19]||(s[19]=t("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:"#E5E5EA","stroke-width":"40"},null,-1)),(r(!0),i(u,null,v(R.value,(a,l)=>(r(),i("circle",{key:l,cx:"100",cy:"100",r:"80",fill:"none",stroke:a.color,"stroke-width":"40","stroke-dasharray":`${a.percentage*502.4/100} 502.4`,"stroke-dashoffset":a.offset,transform:"rotate(-90 100 100)",class:"pie-segment"},null,8,bt))),128))])),t("div",xt,[t("div",Ct,o(c.value.energy.toFixed(1)),1),s[20]||(s[20]=t("div",{class:"pie-label"},[_("总用电量"),t("br"),_("kWh")],-1))])]),t("div",Ft,[(r(!0),i(u,null,v(C.value,(a,l)=>(r(),i("div",{key:l,class:"pie-legend-item"},[t("span",{class:"legend-color",style:b({background:a.color})},null,4),t("span",Mt,o(a.name),1),t("span",$t,o(a.value.toFixed(1))+" kWh",1),t("span",Dt,o(a.percentage.toFixed(1))+"%",1)]))),128))])])])]),t("div",Vt,[t("div",Ht,[s[23]||(s[23]=t("h3",{class:"section-title"},"充电站收入排行",-1)),t("div",Bt,[h(t("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>g.value=a),class:"sort-select"},[...s[22]||(s[22]=[t("option",{value:"revenue"},"按收入排序",-1),t("option",{value:"energy"},"按用电量排序",-1),t("option",{value:"sessions"},"按充电次数排序",-1)])],512),[[M,g.value]])])]),t("div",Lt,[(r(!0),i(u,null,v(j.value,(a,l)=>(r(),i("div",{key:a.id,class:"ranking-item"},[t("div",{class:D(["rank-badge",N(l)])},o(l+1),3),t("div",Rt,[t("div",jt,o(a.name),1),t("div",It,o(a.location),1)]),t("div",Et,[t("div",Nt,[s[24]||(s[24]=t("span",{class:"stat-label"},"收入",-1)),t("span",Tt,"¥"+o(a.revenue.toFixed(2)),1)]),t("div",Wt,[s[25]||(s[25]=t("span",{class:"stat-label"},"用电量",-1)),t("span",qt,o(a.energy.toFixed(1))+" kWh",1)]),t("div",At,[s[26]||(s[26]=t("span",{class:"stat-label"},"充电次数",-1)),t("span",zt,o(a.sessions)+" 次",1)])]),t("div",Ut,[t("div",{class:"progress-fill",style:b({width:E(a.revenue,I.value)+"%"})},null,4)])]))),128))])]),t("div",Zt,[t("div",Yt,[s[29]||(s[29]=t("h3",{class:"section-title"},"详细充电记录",-1)),t("div",Ot,[t("button",{class:"btn-secondary",onClick:q},[(r(),i("svg",Pt,[...s[27]||(s[27]=[t("path",{d:"M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M7 10L12 15L17 10",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),t("path",{d:"M12 15V3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])])),s[28]||(s[28]=_(" 导出数据 ",-1))])])]),t("div",Qt,[t("table",Gt,[s[30]||(s[30]=t("thead",null,[t("tr",null,[t("th",null,"日期"),t("th",null,"充电站"),t("th",null,"用户"),t("th",null,"充电时长"),t("th",null,"用电量 (kWh)"),t("th",null,"单价 (元/kWh)"),t("th",null,"费用 (元)"),t("th",null,"支付方式")])],-1)),t("tbody",null,[(r(!0),i(u,null,v(T.value,a=>(r(),i("tr",{key:a.id},[t("td",Jt,o(a.date),1),t("td",Kt,o(a.station),1),t("td",Xt,o(a.user),1),t("td",ts,o(a.duration),1),t("td",ss,o(a.energy.toFixed(2)),1),t("td",es,o(a.price.toFixed(2)),1),t("td",as,"¥"+o(a.cost.toFixed(2)),1),t("td",os,[t("span",{class:D(["payment-badge","payment-"+a.payment])},o(W(a.payment)),3)])]))),128))])])])])]))}},us=z(ns,[["__scopeId","data-v-83ffd074"]]);export{us as default};
