import{_ as vt,r as v,D as X,q as ct,o as a,c as n,b as t,t as o,h as Y,k as _,e as p,v as y,C as S,F as Z,z as tt,w as E,G as st,A as w,H as x,m as gt}from"./index-80ce5560.js";const pt={class:"page"},ht={class:"stats-row"},ft={class:"stat-card"},wt={class:"stat-info"},bt={class:"stat-value"},kt={class:"stat-card"},mt={class:"stat-info"},_t={class:"stat-value"},yt={class:"stat-card"},xt={class:"stat-info"},Ct={class:"stat-value"},Mt={class:"stat-card"},Ut={class:"stat-info"},Vt={class:"stat-value"},Bt={class:"card"},Ft={class:"toolbar"},Dt={class:"toolbar-left"},At={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"18px",height:"18px","margin-right":"6px"}},zt=["disabled"],It={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"16px",height:"16px"}},St={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"16px",height:"16px","margin-right":"4px"}},Et={class:"toolbar-right"},$t={class:"search-box"},Pt={key:0,class:"loading-state"},Ht={key:1,class:"table-container"},qt={class:"user-table"},Lt={class:"checkbox-col"},Tt=["checked"],Nt={class:"checkbox-col"},Rt=["checked","onChange"],Wt={class:"user-name-cell"},Gt={class:"user-name"},Ot={key:0,class:"vip-badge"},Qt={class:"phone-col"},jt={class:"balance-col"},Jt={class:"number-col"},Kt={class:"number-col"},Xt={class:"date-col"},Yt={class:"actions-col"},Zt={class:"action-buttons"},ts=["onClick"],ss=["onClick"],es=["onClick","title"],ls={key:0,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},os={key:1,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},as=["onClick"],ns={key:2,class:"empty-state"},is={class:"empty-text"},rs={class:"dialog"},ds={class:"dialog-header"},us={class:"form-group"},vs={class:"form-group"},cs={key:0,class:"form-group"},gs={class:"form-row"},ps={class:"form-group"},hs={class:"form-group"},fs={class:"dialog-actions"},ws={type:"submit",class:"btn-primary"},bs={class:"dialog detail-dialog"},ks={class:"dialog-header"},ms={class:"dialog-title-section"},_s={class:"dialog-subtitle"},ys={class:"dialog-body"},xs={class:"detail-section"},Cs={class:"info-grid"},Ms={class:"info-item"},Us={class:"info-value"},Vs={class:"info-item"},Bs={class:"info-item"},Fs={class:"info-item"},Ds={class:"info-value"},As={class:"detail-section"},zs={class:"info-grid"},Is={class:"info-item"},Ss={class:"info-value highlight"},Es={class:"info-item"},$s={class:"info-value"},Ps={class:"info-item"},Hs={class:"info-value"},qs={class:"info-item"},Ls={class:"info-value"},Ts={class:"detail-section"},Ns={class:"record-list"},Rs={class:"record-info"},Ws={class:"record-station"},Gs={class:"record-time"},Os={class:"record-stats"},Qs={class:"record-energy"},js={class:"record-cost"},Js={class:"dialog-footer"},Ks={__name:"User",setup(Xs){const u=v([]),b=v(""),k=v(""),m=v(""),C=v(!1),M=v(!1),h=v(!1),U=v(!1),d=v([]),i=v(null),r=v({id:null,username:"",phone:"",password:"",role:"user",balance:0,status:"active"}),V=X(()=>{const e=u.value.length,s=u.value.filter(g=>g.status==="active").length,c=u.value.filter(g=>g.status==="charging").length,F=u.value.reduce((g,D)=>g+(D.totalChargingEnergy||0),0);return{total:e,active:s,charging:c,totalEnergy:F.toFixed(1)}}),f=X(()=>{let e=[...u.value];if(b.value){const s=b.value.toLowerCase();e=e.filter(c=>c.username.toLowerCase().includes(s)||c.phone.includes(s))}return k.value&&(e=e.filter(s=>s.role===k.value)),m.value&&(e=e.filter(s=>s.status===m.value)),e}),$=e=>({user:"普通用户",vip:"VIP用户",admin:"管理员"})[e]||e,P=e=>({active:"正常",charging:"充电中",disabled:"已禁用"})[e]||e,H=()=>{const e=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)","linear-gradient(135deg, #30cfd0 0%, #330867 100%)","linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)","linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)"];return e[Math.floor(Math.random()*e.length)]},z=async()=>{try{U.value=!0;const e=await x.list({page:1,size:100});u.value=e.records.map(s=>({...s,avatarColor:H(),recentCharges:[]}))}catch(e){console.error("获取用户列表失败:",e)}finally{U.value=!1}},et=()=>{d.value=[],z()},lt=e=>{const s=d.value.indexOf(e);s>-1?d.value.splice(s,1):d.value.push(e)},ot=()=>{d.value.length===f.value.length?d.value=[]:d.value=f.value.map(e=>e.id)},at=async()=>{if(confirm(`确定要删除选中的 ${d.value.length} 个用户吗？`))try{await Promise.all(d.value.map(e=>x.delete(e))),u.value=u.value.filter(e=>!d.value.includes(e.id)),d.value=[]}catch(e){console.error("批量删除失败:",e),alert("批量删除失败"),z()}},nt=()=>{h.value=!1,r.value={id:null,username:"",phone:"",password:"",role:"user",balance:0,status:"active"},C.value=!0},it=e=>{i.value=e,M.value=!0},q=e=>{h.value=!0,r.value={...e},C.value=!0,M.value=!1},rt=async e=>{const s=e.status==="disabled"?"active":"disabled";try{await x.update(e.id,{status:s}),e.status=s}catch(c){console.error("更新状态失败:",c),alert("更新状态失败")}},dt=async e=>{if(confirm(`确定要删除用户"${e.username}"吗？`))try{await x.delete(e.id),u.value=u.value.filter(s=>s.id!==e.id)}catch(s){console.error("删除失败:",s),alert("删除失败")}},B=()=>{C.value=!1},I=()=>{M.value=!1},ut=async()=>{try{if(h.value){await x.update(r.value.id,r.value);const e=u.value.findIndex(s=>s.id===r.value.id);e!==-1&&(u.value[e]={...u.value[e],...r.value})}else{const e=await gt.register(r.value);u.value.unshift({...e,avatarColor:H(),recentCharges:[]})}B()}catch(e){console.error("操作失败:",e),alert("操作失败: "+(e.message||"未知错误"))}};return ct(()=>{z()}),(e,s)=>{var c,F,g,D,L,T,N,R,W,G,O,Q,j,J,K;return a(),n("div",pt,[s[58]||(s[58]=t("h1",{class:"page-title"},"用户信息管理",-1)),t("div",ht,[t("div",ft,[s[10]||(s[10]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #007AFF, #5856D6)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",wt,[t("div",bt,o(V.value.total),1),s[9]||(s[9]=t("div",{class:"stat-label"},"总用户数",-1))])]),t("div",kt,[s[12]||(s[12]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #34C759, #30D158)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M9 12l2 2 4-4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",mt,[t("div",_t,o(V.value.active),1),s[11]||(s[11]=t("div",{class:"stat-label"},"活跃用户",-1))])]),t("div",yt,[s[14]||(s[14]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #FF9500, #FF6B00)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z",fill:"currentColor"})])],-1)),t("div",xt,[t("div",Ct,o(V.value.charging),1),s[13]||(s[13]=t("div",{class:"stat-label"},"充电中",-1))])]),t("div",Mt,[s[16]||(s[16]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #AF52DE, #BF5AF2)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",stroke:"currentColor","stroke-width":"2"}),t("line",{x1:"7",y1:"12",x2:"17",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",Ut,[t("div",Vt,o(V.value.totalEnergy),1),s[15]||(s[15]=t("div",{class:"stat-label"},"累计电量(kWh)",-1))])])]),t("div",Bt,[t("div",Ft,[t("div",Dt,[t("button",{class:"btn-primary",onClick:nt},[(a(),n("svg",At,[...s[17]||(s[17]=[t("path",{d:"M12 5v14M5 12h14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),s[18]||(s[18]=Y(" 添加用户 ",-1))]),t("button",{class:"btn-secondary",onClick:et,disabled:U.value},[(a(),n("svg",It,[...s[19]||(s[19]=[t("path",{d:"M21 10c-2.4-2.4-5.7-3.9-9.4-3.9-7.2 0-13.1 5.9-13.1 13.1M3 14c2.4 2.4 5.7 3.9 9.4 3.9 7.2 0 13.1-5.9 13.1-13.1",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1),t("path",{d:"M21 3v7h-7M3 21v-7h7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])]))],8,zt),d.value.length>0?(a(),n("button",{key:0,class:"btn-secondary",onClick:at},[(a(),n("svg",St,[...s[20]||(s[20]=[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),Y(" 批量删除 ("+o(d.value.length)+") ",1)])):_("",!0)]),t("div",Et,[t("div",$t,[s[21]||(s[21]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"search-icon"},[t("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)),p(t("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>b.value=l),type:"text",placeholder:"搜索用户名、手机号...",class:"search-input"},null,512),[[y,b.value]])]),p(t("select",{"onUpdate:modelValue":s[1]||(s[1]=l=>k.value=l),class:"filter-select"},[...s[22]||(s[22]=[t("option",{value:""},"全部角色",-1),t("option",{value:"user"},"普通用户",-1),t("option",{value:"vip"},"VIP用户",-1),t("option",{value:"admin"},"管理员",-1)])],512),[[S,k.value]]),p(t("select",{"onUpdate:modelValue":s[2]||(s[2]=l=>m.value=l),class:"filter-select"},[...s[23]||(s[23]=[t("option",{value:""},"全部状态",-1),t("option",{value:"active"},"正常",-1),t("option",{value:"charging"},"充电中",-1),t("option",{value:"disabled"},"已禁用",-1)])],512),[[S,m.value]])])]),U.value?(a(),n("div",Pt,[...s[24]||(s[24]=[t("div",{class:"spinner"},null,-1),t("p",null,"加载中...",-1)])])):f.value.length>0?(a(),n("div",Ht,[t("table",qt,[t("thead",null,[t("tr",null,[t("th",Lt,[t("input",{type:"checkbox",onChange:ot,checked:d.value.length===f.value.length&&f.value.length>0},null,40,Tt)]),s[25]||(s[25]=t("th",null,"头像",-1)),s[26]||(s[26]=t("th",null,"用户名",-1)),s[27]||(s[27]=t("th",null,"手机号",-1)),s[28]||(s[28]=t("th",null,"角色",-1)),s[29]||(s[29]=t("th",null,"余额",-1)),s[30]||(s[30]=t("th",null,"充电次数",-1)),s[31]||(s[31]=t("th",null,"累计电量",-1)),s[32]||(s[32]=t("th",null,"状态",-1)),s[33]||(s[33]=t("th",null,"注册时间",-1)),s[34]||(s[34]=t("th",{class:"actions-col"},"操作",-1))])]),t("tbody",null,[(a(!0),n(Z,null,tt(f.value,l=>(a(),n("tr",{key:l.id,class:w({selected:d.value.includes(l.id)})},[t("td",Nt,[t("input",{type:"checkbox",checked:d.value.includes(l.id),onChange:A=>lt(l.id)},null,40,Rt)]),t("td",null,[t("div",{class:"user-avatar",style:st({background:l.avatarColor})},o(l.username.charAt(0).toUpperCase()),5)]),t("td",null,[t("div",Wt,[t("span",Gt,o(l.username),1),l.role==="vip"?(a(),n("span",Ot,"VIP")):_("",!0)])]),t("td",Qt,o(l.phone),1),t("td",null,[t("span",{class:w(["role-badge","role-"+l.role])},o($(l.role)),3)]),t("td",jt,"¥"+o(l.balance.toFixed(2)),1),t("td",Jt,o(l.totalChargingCount),1),t("td",Kt,o(l.totalChargingEnergy.toFixed(1)),1),t("td",null,[t("span",{class:w(["status-badge","status-"+l.status])},o(P(l.status)),3)]),t("td",Xt,o(l.createdAt),1),t("td",Yt,[t("div",Zt,[t("button",{class:"btn-icon btn-view",onClick:A=>it(l),title:"查看"},[...s[35]||(s[35]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor","stroke-width":"2"}),t("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor","stroke-width":"2"})],-1)])],8,ts),t("button",{class:"btn-icon btn-edit",onClick:A=>q(l),title:"编辑"},[...s[36]||(s[36]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor","stroke-width":"2"})],-1)])],8,ss),t("button",{class:w(["btn-icon",l.status==="disabled"?"btn-enable":"btn-disable"]),onClick:A=>rt(l),title:l.status==="disabled"?"启用":"禁用"},[l.status==="disabled"?(a(),n("svg",ls,[...s[37]||(s[37]=[t("path",{d:"M5 3l14 9-14 9V3z",fill:"currentColor"},null,-1)])])):(a(),n("svg",os,[...s[38]||(s[38]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"},null,-1),t("path",{d:"M15 9l-6 6M9 9l6 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])]))],10,es),t("button",{class:"btn-icon btn-delete",onClick:A=>dt(l),title:"删除"},[...s[39]||(s[39]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2",stroke:"currentColor","stroke-width":"2"})],-1)])],8,as)])])],2))),128))])])])):(a(),n("div",ns,[s[40]||(s[40]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"empty-icon"},[t("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor","stroke-width":"2"})],-1)),t("p",is,o(b.value||k.value||m.value?"未找到匹配的用户":"暂无用户，点击上方按钮添加"),1)]))]),C.value?(a(),n("div",{key:0,class:"dialog-overlay",onClick:E(B,["self"])},[t("div",rs,[t("div",ds,[t("h2",null,o(h.value?"编辑用户":"添加用户"),1),t("button",{class:"close-btn",onClick:B},"×")]),t("form",{onSubmit:E(ut,["prevent"]),class:"dialog-body"},[t("div",us,[s[41]||(s[41]=t("label",null,"用户名 *",-1)),p(t("input",{"onUpdate:modelValue":s[3]||(s[3]=l=>r.value.username=l),type:"text",placeholder:"请输入用户名",required:""},null,512),[[y,r.value.username]])]),t("div",vs,[s[42]||(s[42]=t("label",null,"手机号 *",-1)),p(t("input",{"onUpdate:modelValue":s[4]||(s[4]=l=>r.value.phone=l),type:"tel",placeholder:"请输入手机号",pattern:"1[3-9]\\d{9}",required:""},null,512),[[y,r.value.phone]])]),h.value?_("",!0):(a(),n("div",cs,[s[43]||(s[43]=t("label",null,"密码 *",-1)),p(t("input",{"onUpdate:modelValue":s[5]||(s[5]=l=>r.value.password=l),type:"password",placeholder:"请输入密码",minlength:"6",required:""},null,512),[[y,r.value.password]])])),t("div",gs,[t("div",ps,[s[45]||(s[45]=t("label",null,"角色",-1)),p(t("select",{"onUpdate:modelValue":s[6]||(s[6]=l=>r.value.role=l)},[...s[44]||(s[44]=[t("option",{value:"user"},"普通用户",-1),t("option",{value:"vip"},"VIP用户",-1),t("option",{value:"admin"},"管理员",-1)])],512),[[S,r.value.role]])]),t("div",hs,[s[46]||(s[46]=t("label",null,"账户余额",-1)),p(t("input",{"onUpdate:modelValue":s[7]||(s[7]=l=>r.value.balance=l),type:"number",step:"0.01",min:"0",placeholder:"0.00"},null,512),[[y,r.value.balance,void 0,{number:!0}]])])]),t("div",fs,[t("button",{type:"button",class:"btn-secondary",onClick:B},"取消"),t("button",ws,o(h.value?"保存":"添加"),1)])],32)])])):_("",!0),M.value?(a(),n("div",{key:1,class:"dialog-overlay",onClick:E(I,["self"])},[t("div",bs,[t("div",ks,[t("div",ms,[t("div",{class:"user-avatar-large",style:st({background:(c=i.value)==null?void 0:c.avatarColor})},o((F=i.value)==null?void 0:F.username.charAt(0).toUpperCase()),5),t("div",null,[t("h2",null,o((g=i.value)==null?void 0:g.username),1),t("p",_s,o((D=i.value)==null?void 0:D.phone),1)])]),t("button",{class:"close-btn",onClick:I},"×")]),t("div",ys,[t("div",xs,[s[51]||(s[51]=t("h3",{class:"section-title"},"基本信息",-1)),t("div",Cs,[t("div",Ms,[s[47]||(s[47]=t("span",{class:"info-label"},"用户ID",-1)),t("span",Us,o((L=i.value)==null?void 0:L.id),1)]),t("div",Vs,[s[48]||(s[48]=t("span",{class:"info-label"},"角色",-1)),t("span",{class:w(["role-badge","role-"+((T=i.value)==null?void 0:T.role)])},o($((N=i.value)==null?void 0:N.role)),3)]),t("div",Bs,[s[49]||(s[49]=t("span",{class:"info-label"},"状态",-1)),t("span",{class:w(["status-badge","status-"+((R=i.value)==null?void 0:R.status)])},o(P((W=i.value)==null?void 0:W.status)),3)]),t("div",Fs,[s[50]||(s[50]=t("span",{class:"info-label"},"注册时间",-1)),t("span",Ds,o((G=i.value)==null?void 0:G.createdAt),1)])])]),t("div",As,[s[56]||(s[56]=t("h3",{class:"section-title"},"账户信息",-1)),t("div",zs,[t("div",Is,[s[52]||(s[52]=t("span",{class:"info-label"},"账户余额",-1)),t("span",Ss,"¥"+o((O=i.value)==null?void 0:O.balance.toFixed(2)),1)]),t("div",Es,[s[53]||(s[53]=t("span",{class:"info-label"},"充电次数",-1)),t("span",$s,o((Q=i.value)==null?void 0:Q.totalChargingCount)+" 次",1)]),t("div",Ps,[s[54]||(s[54]=t("span",{class:"info-label"},"累计电量",-1)),t("span",Hs,o((j=i.value)==null?void 0:j.totalChargingEnergy.toFixed(1))+" kWh",1)]),t("div",qs,[s[55]||(s[55]=t("span",{class:"info-label"},"累计消费",-1)),t("span",Ls,"¥"+o((J=i.value)==null?void 0:J.totalChargingFee.toFixed(2)),1)])])]),t("div",Ts,[s[57]||(s[57]=t("h3",{class:"section-title"},"最近充电记录",-1)),t("div",Ns,[(a(!0),n(Z,null,tt(((K=i.value)==null?void 0:K.recentCharges)||[],l=>(a(),n("div",{key:l.id,class:"record-item"},[t("div",Rs,[t("div",Ws,o(l.station),1),t("div",Gs,o(l.time),1)]),t("div",Os,[t("div",Qs,o(l.energy)+" kWh",1),t("div",js,"¥"+o(l.cost),1)])]))),128))])])]),t("div",Js,[t("button",{class:"btn-secondary",onClick:I},"关闭"),t("button",{class:"btn-primary",onClick:s[8]||(s[8]=l=>q(i.value))},"编辑用户")])])])):_("",!0)])}}},Zs=vt(Ks,[["__scopeId","data-v-63b9ce50"]]);export{Zs as default};
