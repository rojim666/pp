import{_ as X,J as Z,a as tt,r as w,E,q as et,o as a,c as i,b as t,t as u,y as h,h as H,k,e as v,v as m,D as U,d as z,F,z as st,w as L,G as y,A as $,K as q}from"./index-324e4295.js";const ot={class:"page"},lt={class:"stats-row"},nt={class:"stat-card"},at={class:"stat-info"},it={class:"stat-value"},rt={class:"stat-card"},dt={class:"stat-info"},ut={class:"stat-value"},vt={class:"stat-card"},ct={class:"stat-info"},pt={class:"stat-value"},gt={class:"card"},wt={class:"toolbar"},ht={class:"toolbar-left"},mt={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"18px",height:"18px","margin-right":"6px"}},ft=["disabled"],kt={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"16px",height:"16px"}},yt={viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{width:"16px",height:"16px","margin-right":"4px"}},xt={class:"toolbar-right"},bt={class:"search-box"},Ct={key:0,class:"loading-state"},_t={key:1,class:"stations-grid"},Mt={class:"station-checkbox"},Vt=["checked","onChange"],St={class:"station-header"},It={class:"station-info"},At={class:"station-name"},Bt={class:"station-code"},Dt={class:"station-status"},Ut={class:"station-details"},$t={class:"detail-row"},Tt={class:"detail-item"},Nt={class:"detail-text"},Et={class:"detail-row"},Ht={class:"detail-item"},zt={class:"detail-text"},Ft={class:"detail-item"},Lt={class:"detail-text"},qt={class:"detail-row"},Gt={class:"detail-item"},Rt={class:"detail-text"},Ot={class:"detail-item"},Wt={class:"detail-text"},Pt={class:"station-actions"},Yt=["onClick","disabled","title"],Jt={key:0,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Kt={key:1,style:{"font-size":"12px","font-weight":"bold"}},Qt={key:1,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},jt=["onClick"],Xt=["onClick","title"],Zt={key:0,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},te={key:1,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},ee=["onClick"],se={key:2,class:"empty-state"},oe={class:"empty-text"},le={class:"dialog"},ne={class:"dialog-header"},ae={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},de={class:"form-group"},ue={class:"form-row"},ve={class:"form-group"},ce={class:"form-group"},pe={class:"form-row"},ge={class:"form-group"},we={class:"form-group"},he={class:"form-group"},me={class:"dialog-actions"},fe={type:"submit",class:"btn-primary"},ke={__name:"Charging",setup(ye){const{success:f,error:x}=Z(),c=tt(),d=w([]),C=w(""),_=w(""),M=w("id"),S=w(!1),V=w(!1),I=w(!1),p=w([]),l=w({id:null,name:"",code:"",serialNumber:"",location:"",type:"ac",power:7,voltage:220,current:32,installDate:new Date().toISOString().split("T")[0],status:"online"}),T=E(()=>{const o=d.value.length,e=d.value.filter(r=>r.status==="online").length,s=d.value.filter(r=>r.status==="charging").length,n=d.value.reduce((r,g)=>r+(g.totalRevenue||0),0);return{total:o,active:e,charging:s,totalRevenue:n}}),N=E(()=>{let o=[...d.value];if(C.value){const e=C.value.toLowerCase();o=o.filter(s=>s.name.toLowerCase().includes(e)||s.code.toLowerCase().includes(e)||(s.location||s.address||"").toLowerCase().includes(e))}return _.value&&(o=o.filter(e=>e.status===_.value)),M.value!=="id"&&o.sort((e,s)=>{const n=e[M.value]||0,r=s[M.value]||0;return typeof n=="string"?n.localeCompare(r):r-n}),o}),G=o=>({online:"运行中",offline:"已停用",maintenance:"维护中",charging:"充电中",error:"故障",ACTIVE:"运行中",INACTIVE:"已停用",MAINTENANCE:"维护中",CHARGING:"充电中"})[o]||o,A=async()=>{try{I.value=!0;const o=await y.list();d.value=o.records||o||[]}catch(o){console.error("加载充电桩列表失败:",o),d.value=[]}finally{I.value=!1}},R=()=>{p.value=[],A()},O=o=>{const e=p.value.indexOf(o);e>-1?p.value.splice(e,1):p.value.push(o)},W=async()=>{if(confirm(`确定要删除选中的 ${p.value.length} 个充电桩吗？`))try{d.value=d.value.filter(o=>!p.value.includes(o.id)),p.value=[],f("批量删除成功")}catch(o){console.error("批量删除失败:",o),x("批量删除失败")}},P=()=>{V.value=!1,l.value={id:null,name:"",code:"",serialNumber:"",location:"",type:"ac",power:7,voltage:220,current:32,installDate:new Date().toISOString().split("T")[0],status:"online"},S.value=!0},Y=o=>{V.value=!0,l.value={...o,location:o.location||o.address,installDate:o.installDate||new Date().toISOString().split("T")[0]},S.value=!0},J=async o=>{var e;try{if(o.status==="online"){const s=((e=c.currentUser)==null?void 0:e.id)||1,n=new Date,r=b=>b<10?"0"+b:b,g=`${n.getFullYear()}-${r(n.getMonth()+1)}-${r(n.getDate())} ${r(n.getHours())}:${r(n.getMinutes())}:${r(n.getSeconds())}`;await q.start({stationId:o.id,userId:s,startTime:g,startSoc:20}),f("已开始充电"),A()}else if(o.status==="charging"){if(!o.activeRecordId){x("无法结束充电：未找到进行中的订单");return}const s=new Date,n=g=>g<10?"0"+g:g,r=`${s.getFullYear()}-${n(s.getMonth()+1)}-${n(s.getDate())} ${n(s.getHours())}:${n(s.getMinutes())}:${n(s.getSeconds())}`;await q.end(o.activeRecordId,{endTime:r,endSoc:100}),await c.fetchCurrentUser(),f("充电已结束"),A()}}catch(s){console.error("操作失败:",s),x("操作失败: "+(s.message||"未知错误"))}},K=async o=>{try{const e=o.status==="online"||o.status==="charging"?"offline":"online";await y.updateStatus(o.id,e),o.status=e,f("状态更新成功")}catch(e){console.error("更新状态失败:",e),x("更新状态失败")}},Q=async o=>{if(confirm(`确定要删除充电桩"${o.name}"吗？`))try{await y.delete(o.id),d.value=d.value.filter(e=>e.id!==o.id),f("删除成功")}catch(e){console.error("删除失败:",e),x("删除失败")}},B=()=>{S.value=!1},j=async()=>{try{if(V.value){const o=await y.update(l.value.id,l.value),e=d.value.find(n=>n.id===l.value.id);e&&e.status!==l.value.status&&(await y.updateStatus(l.value.id,l.value.status),o&&(o.status=l.value.status));const s=d.value.findIndex(n=>n.id===l.value.id);s!==-1&&(d.value[s]=o||{...l.value}),f("更新成功")}else{const o=await y.create(l.value);if(l.value.status&&l.value.status!=="online"&&o&&o.id)try{await y.updateStatus(o.id,l.value.status),o.status=l.value.status}catch(e){console.error("更新初始状态失败",e)}d.value.unshift(o),f("添加成功")}B()}catch(o){console.error("提交失败:",o),x("提交失败: "+(o.message||"未知错误"))}};return et(()=>{A()}),(o,e)=>(a(),i("div",ot,[e[49]||(e[49]=t("h1",{class:"page-title"},"充电桩",-1)),t("div",lt,[t("div",nt,[e[13]||(e[13]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #34C759, #30D158)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z",fill:"currentColor"})])],-1)),t("div",at,[t("div",it,u(T.value.total),1),e[12]||(e[12]=t("div",{class:"stat-label"},"总数",-1))])]),t("div",rt,[e[15]||(e[15]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #007AFF, #5856D6)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M9 12l2 2 4-4",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",dt,[t("div",ut,u(T.value.active),1),e[14]||(e[14]=t("div",{class:"stat-label"},"运行中",-1))])]),t("div",vt,[e[17]||(e[17]=t("div",{class:"stat-icon",style:{background:"linear-gradient(135deg, #FF9500, #FF6B00)"}},[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M12 2v6m0 4v10M6.34 6.34l4.24 4.24m7.07-4.24l-4.24 4.24",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})])],-1)),t("div",ct,[t("div",pt,u(T.value.charging),1),e[16]||(e[16]=t("div",{class:"stat-label"},"充电中",-1))])])]),t("div",gt,[t("div",wt,[t("div",ht,[h(c).isAdmin?(a(),i("button",{key:0,class:"btn-primary",onClick:P},[(a(),i("svg",mt,[...e[18]||(e[18]=[t("path",{d:"M12 5v14M5 12h14",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),e[19]||(e[19]=H(" 添加充电桩 ",-1))])):k("",!0),t("button",{class:"btn-secondary",onClick:R,disabled:I.value},[(a(),i("svg",kt,[...e[20]||(e[20]=[t("path",{d:"M21 10c-2.4-2.4-5.7-3.9-9.4-3.9-7.2 0-13.1 5.9-13.1 13.1M3 14c2.4 2.4 5.7 3.9 9.4 3.9 7.2 0 13.1-5.9 13.1-13.1",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1),t("path",{d:"M21 3v7h-7M3 21v-7h7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])]))],8,ft),h(c).isAdmin&&p.value.length>0?(a(),i("button",{key:1,class:"btn-secondary",onClick:W},[(a(),i("svg",yt,[...e[21]||(e[21]=[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),H(" 批量删除 ("+u(p.value.length)+") ",1)])):k("",!0)]),t("div",xt,[t("div",bt,[e[22]||(e[22]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"search-icon"},[t("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor","stroke-width":"2"}),t("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)),v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),type:"text",placeholder:"搜索名称、编号、地址...",class:"search-input"},null,512),[[m,C.value]])]),v(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),class:"filter-select"},[...e[23]||(e[23]=[z('<option value="" data-v-936f508e>全部状态</option><option value="online" data-v-936f508e>运行中</option><option value="charging" data-v-936f508e>充电中</option><option value="offline" data-v-936f508e>已停用</option><option value="maintenance" data-v-936f508e>维护中</option>',5)])],512),[[U,_.value]]),v(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>M.value=s),class:"filter-select"},[...e[24]||(e[24]=[z('<option value="id" data-v-936f508e>默认排序</option><option value="name" data-v-936f508e>按名称</option><option value="power" data-v-936f508e>按功率</option><option value="price" data-v-936f508e>按单价</option><option value="totalEnergy" data-v-936f508e>按充电量</option>',5)])],512),[[U,M.value]])])]),I.value?(a(),i("div",Ct,[...e[25]||(e[25]=[t("div",{class:"spinner"},null,-1),t("p",null,"加载中...",-1)])])):N.value.length>0?(a(),i("div",_t,[(a(!0),i(F,null,st(N.value,s=>{var n,r,g,b;return a(),i("div",{key:s.id,class:$(["station-card",["status-"+s.status,{selected:p.value.includes(s.id)}]])},[t("div",Mt,[t("input",{type:"checkbox",checked:p.value.includes(s.id),onChange:D=>O(s.id)},null,40,Vt)]),t("div",St,[t("div",It,[t("h3",At,u(s.name),1),t("span",Bt,u(s.code),1)]),t("div",Dt,[t("span",{class:$(["status-badge","badge-"+s.status])},u(G(s.status)),3)])]),t("div",Ut,[t("div",$t,[t("div",Tt,[e[26]||(e[26]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"detail-icon"},[t("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor","stroke-width":"2"}),t("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor","stroke-width":"2"})],-1)),t("span",Nt,u(s.address),1)])]),t("div",Et,[t("div",Ht,[e[27]||(e[27]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"detail-icon"},[t("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z",stroke:"currentColor","stroke-width":"2"})],-1)),t("span",zt,u(s.power)+" kW",1)]),t("div",Ft,[e[28]||(e[28]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"detail-icon"},[t("path",{d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z",stroke:"currentColor","stroke-width":"2"})],-1)),t("span",Lt,"¥"+u(s.price)+"/kWh",1)])]),t("div",qt,[t("div",Gt,[e[29]||(e[29]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"detail-icon"},[t("rect",{x:"3",y:"6",width:"18",height:"12",rx:"2",stroke:"currentColor","stroke-width":"2"}),t("line",{x1:"7",y1:"12",x2:"17",y2:"12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)),t("span",Rt,"累计 "+u(s.totalEnergy||0)+" kWh",1)]),t("div",Ot,[e[30]||(e[30]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"detail-icon"},[t("path",{d:"M20 12v8H4v-8M22 7h-4a2 2 0 00-2 2v1m0 0H8m8 0v6m-8-6V9a2 2 0 00-2-2H2m6 4v6m4 3H8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)),t("span",Wt,"¥"+u(((s.totalEnergy||0)*s.price).toLocaleString()),1)])])]),t("div",Pt,[["online","charging"].includes(s.status)?(a(),i("button",{key:0,class:$(["btn-action",s.status==="charging"?s.activeUserId===((n=h(c).currentUser)==null?void 0:n.id)?"btn-charge-stop":"btn-charge-occupied":"btn-charge-start"]),onClick:D=>J(s),disabled:s.status==="charging"&&s.activeUserId!==((r=h(c).currentUser)==null?void 0:r.id),title:s.status==="charging"?s.activeUserId===((g=h(c).currentUser)==null?void 0:g.id)?"结束充电":"占用中":"模拟充电"},[s.status==="charging"?(a(),i(F,{key:0},[s.activeUserId===((b=h(c).currentUser)==null?void 0:b.id)?(a(),i("svg",Jt,[...e[31]||(e[31]=[t("rect",{x:"6",y:"6",width:"12",height:"12",rx:"2",fill:"currentColor"},null,-1)])])):(a(),i("span",Kt,"占用中"))],64)):(a(),i("svg",Qt,[...e[32]||(e[32]=[t("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z",fill:"currentColor"},null,-1)])]))],10,Yt)):k("",!0),h(c).isAdmin?(a(),i("button",{key:1,class:"btn-action btn-edit",onClick:D=>Y(s),title:"编辑"},[...e[33]||(e[33]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],8,jt)):k("",!0),h(c).isAdmin?(a(),i("button",{key:2,class:$(["btn-action",["online","charging","ACTIVE","CHARGING"].includes(s.status)?"btn-stop":"btn-start"]),onClick:D=>K(s),title:["online","charging","ACTIVE","CHARGING"].includes(s.status)?"停用":"启用"},[["online","charging","ACTIVE","CHARGING"].includes(s.status)?(a(),i("svg",Zt,[...e[34]||(e[34]=[t("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z",fill:"currentColor"},null,-1)])])):(a(),i("svg",te,[...e[35]||(e[35]=[t("path",{d:"M5 3l14 9-14 9V3z",fill:"currentColor"},null,-1)])]))],10,Xt)):k("",!0),h(c).isAdmin?(a(),i("button",{key:3,class:"btn-action btn-delete",onClick:D=>Q(s),title:"删除"},[...e[36]||(e[36]=[t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1)])],8,ee)):k("",!0)])],2)}),128))])):(a(),i("div",se,[e[37]||(e[37]=t("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"empty-icon"},[t("path",{d:"M13 2L3 14h8l-1 8 10-12h-8l1-8z",stroke:"currentColor","stroke-width":"2"})],-1)),t("p",oe,u(C.value||_.value?"未找到匹配的充电桩":"暂无充电桩，点击上方按钮添加"),1)]))]),S.value?(a(),i("div",{key:0,class:"dialog-overlay",onClick:L(B,["self"])},[t("div",le,[t("div",ne,[t("h2",null,u(V.value?"编辑充电桩":"添加充电桩"),1),t("button",{class:"close-btn",onClick:B},"×")]),t("form",{onSubmit:L(j,["prevent"]),class:"dialog-body"},[t("div",ae,[e[38]||(e[38]=t("label",null,"充电桩名称 *",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.value.name=s),type:"text",placeholder:"例如: 停车场A区-01号桩",required:""},null,512),[[m,l.value.name]])]),t("div",ie,[e[39]||(e[39]=t("label",null,"充电桩编号 *",-1)),v(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.code=s),type:"text",placeholder:"例如: CS001",required:""},null,512),[[m,l.value.code]])]),t("div",re,[e[40]||(e[40]=t("label",null,"设备序列号/设备ID",-1)),v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>l.value.serialNumber=s),type:"text",placeholder:"例如: 84:F7:03:12:34:56"},null,512),[[m,l.value.serialNumber]])]),t("div",de,[e[41]||(e[41]=t("label",null,"安装地址 *",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>l.value.location=s),type:"text",placeholder:"详细地址",required:""},null,512),[[m,l.value.location]])]),t("div",ue,[t("div",ve,[e[43]||(e[43]=t("label",null,"类型 *",-1)),v(t("select",{"onUpdate:modelValue":e[7]||(e[7]=s=>l.value.type=s),required:""},[...e[42]||(e[42]=[t("option",{value:"ac"},"交流慢充",-1),t("option",{value:"dc"},"直流快充",-1),t("option",{value:"super"},"超级快充",-1)])],512),[[U,l.value.type]])]),t("div",ce,[e[44]||(e[44]=t("label",null,"充电功率 (kW) *",-1)),v(t("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>l.value.power=s),type:"number",step:"0.1",min:"0",placeholder:"7",required:""},null,512),[[m,l.value.power,void 0,{number:!0}]])])]),t("div",pe,[t("div",ge,[e[45]||(e[45]=t("label",null,"电压 (V) *",-1)),v(t("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.voltage=s),type:"number",step:"1",min:"0",placeholder:"220",required:""},null,512),[[m,l.value.voltage,void 0,{number:!0}]])]),t("div",we,[e[46]||(e[46]=t("label",null,"电流 (A) *",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>l.value.current=s),type:"number",step:"1",min:"0",placeholder:"32",required:""},null,512),[[m,l.value.current,void 0,{number:!0}]])])]),t("div",he,[e[48]||(e[48]=t("label",null,"状态",-1)),v(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.value.status=s)},[...e[47]||(e[47]=[t("option",{value:"online"},"运行中",-1),t("option",{value:"offline"},"已停用",-1),t("option",{value:"maintenance"},"维护中",-1)])],512),[[U,l.value.status]])]),t("div",me,[t("button",{type:"button",class:"btn-secondary",onClick:B},"取消"),t("button",fe,u(V.value?"保存":"添加"),1)])],32)])])):k("",!0)]))}},be=X(ke,[["__scopeId","data-v-936f508e"]]);export{be as default};
